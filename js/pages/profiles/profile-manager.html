<div
  class="modal"
  id="modalHighlights"
  tabindex="-1 "
  role="dialog"
  data-backdrop="false"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
        <i class="fa fa-lightbulb"></i> Event Highlighting
      </div>
      <div class="modal-body">
        <div class="row highlight-pane">
          <div class="btn-group" role="group">
            <button
              title="set selected events color"
              class="btn"
              data-bind="click: setHighlights(0), style: {borderColor: getHighlightColor(0), backgroundColor: getHighlightBackground(0)}"
            >
              <i
                data-bind="style: {color: getHighlightColor(0)}"
                class="fa fa-paint-brush"
              ></i>
            </button>
            <button
              title="set selected events color"
              class="btn"
              data-bind="click: setHighlights(1), style: {borderColor: getHighlightColor(1), backgroundColor: getHighlightBackground(1)}"
            >
              <i
                data-bind="style: {color: getHighlightColor(1)}"
                class="fa fa-paint-brush"
              ></i>
            </button>
            <button
              title="set selected events color"
              class="btn"
              data-bind="click: setHighlights(2), style: {borderColor: getHighlightColor(2), backgroundColor: getHighlightBackground(2)}"
            >
              <i
                data-bind="style: {color: getHighlightColor(2)}"
                class="fa fa-paint-brush"
              ></i>
            </button>
            <button
              title="set selected events color"
              class="btn"
              data-bind="click: setHighlights(3), style: {borderColor: getHighlightColor(3), backgroundColor: getHighlightBackground(3)}"
            >
              <i
                data-bind="style: {color: getHighlightColor(3)}"
                class="fa fa-paint-brush"
              ></i>
            </button>
            <button
              title="set selected events color"
              class="btn"
              data-bind="click: setHighlights(4), style: {borderColor: getHighlightColor(4), backgroundColor: getHighlightBackground(4)}"
            >
              <i
                data-bind="style: {color: getHighlightColor(4)}"
                class="fa fa-paint-brush"
              ></i>
            </button>
            <button
              title="set selected events color"
              class="btn"
              data-bind="click: setHighlights(5), style: {borderColor: getHighlightColor(5), backgroundColor: getHighlightBackground(5)}"
            >
              <i
                data-bind="style: {color: getHighlightColor(5)}"
                class="fa fa-paint-brush"
              ></i>
            </button>
            <button
              title="clear all highlight colors"
              class="btn btn-default"
              data-bind="click:clearHighlights"
            >
              <i class="fa fa-eraser"></i>
            </button>
          </div>
        </div>
        <faceted-datatable
          id="highlight-table"
          params="{
								reference: highlightData,
								columns: highlightColumns,
								options: highlightOptions,
								order: [[4,'desc']],
								pageLength: 5,
								rowClick: highlightRowClick,
								dom: highlightDom
							}"
        ></faceted-datatable>
      </div>
    </div>
  </div>
</div>
<!-- patient table modal -->
<div
  class="modal"
  id="modalPatientSelection"
  tabindex="-1 "
  role="dialog"
  data-backdrop="false"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button
          type="button"
          class="selectionPatient close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
        <i class="fa fa-lightbulb"></i>Sample name
      </div>
      <div class="modal-body">
        <div class="row" style="float: right;">
          <button  class="btn btn-primary" data-bind="click: comparePatient">
            View patient(s)
          </button>
        </div>
        <faceted-datatable
          id="patientSelection-table"
          params="{
								reference: patientSelectionData,
								columns: patientSelectionColumn,
								order: [[1,'asc']],
                pageLength: -1,
                rowClick: onSampleDataClick,
							}"
        ></faceted-datatable>
      </div>
    </div>
  </div>
</div>


</div>
<heading-title
  params="name: 'Profiles', icon: 'user', theme: 'dark'"
></heading-title>

<div data-bind="if:$component.canViewProfiles">
  <div class="asset-heading">
    <form data-bind="submit:loadPerson">
      <div class="input-group" role="group">
        <div class="input-group-btn" role="group">
          <button
            type="button"
            title="choose a data source"
            class="btn btn-primary dropdown-toggle"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
            data-bind="enable: !sampleId()"
          >
            <span data-bind="text:$component.sourceKeyCaption"></span
            >&nbsp;&nbsp;<span class="caret"></span>
          </button>
          <ul
            class="dropdown-menu"
            data-bind="enable: !person() && !loadingPerson(),foreach: permittedSources().filter(d=>d.hasCDM)"
          >
            <li>
              <a
                href="#"
                data-bind="text:sourceName,click:$component.setSourceKey"
              ></a>
            </li>
          </ul>
        </div>
        <input
          type="text"
          class="form-control"
          placeholder="Person Id"
          data-bind="enable: sourceKey(),value: personId, visible: !sampleId()"
        />
        <input
          type="text"
          class="form-control"
          placeholder="Person Id"
          data-bind="enable: sourceKey()&&!sampleId(),value: combinedPersonIds(), visible: sampleId()"
        />
        <div class="input-group-btn" role="group" >
          <button
            data-bind="visible: sampleId()"
            type="button"
            class="btn btn-primary"
            title="Select a patient to compare"
            data-toggle="modal"
            data-target="#modalPatientSelection"
          >
            <span>
              <i class="fa fa-user" />
            </span>
          </button>
        <div
            class="btn btn-primary"
            title="toggle chart display"
            data-bind="css:{active:$component.showSection.profileChart},click:$component.dispToggle, value:'profileChart'"
          >
            <i class="fa fa-line-chart" data-bind="value:'profileChart'" />
          </div>
          <div
            class="btn btn-primary"
            title="toggle table display"
            data-bind="css:{active:$component.showSection.datatable},click:$component.dispToggle, value:'datatable'"
          >
            <i class="fa fa-table" data-bind="value:'datatable'" />
          </div> 
        </div>
        <!-- <div class="input-group-btn" role="group">
          <button
            type="button"
            class="btn btn-primary"
            title="highlight events"
            data-toggle="modal"
            data-target="#modalHighlights"
          >
            <span><i class="fa fa-paint-brush"></i></span>
          </button>
        </div> -->
      </div>
    </form>
    <div
      style="margin-top:5px;"
      data-bind="visible:person && !cantFindPerson() && !loadingPerson(), with:person"
    >
      <!-- ko if:$component.sampleId() -->
      <span data-bind="text:'Patient ID: ' + $component.personId()"></span
      >&nbsp;&nbsp;|&nbsp;&nbsp;
      <!-- /ko -->
      <i data-bind="attr: {class : $component.getGenderClass}"></i>&nbsp;
      <span data-bind="text: gender"></span>&nbsp;&nbsp;|&nbsp;&nbsp;
      <span data-bind="text: recordCount + ' events'"></span
      >&nbsp;&nbsp;|&nbsp;&nbsp;
      <span data-bind="text: `Age ${ageAtIndex} `"></span>
      <span data-bind="if: $component.currentCohortDefinition() != null"
        >at index</span
      >
      <span data-bind="if: $component.currentCohortDefinition() == null"
        >at start of observation</span
      >
      <span data-bind="if: $component.currentCohortDefinition() != null"
        >|&nbsp;&nbsp;Cohort:
        <a
          class="asset-heading-link"
          data-bind="text: $component.currentCohortDefinition().name(), attr: {href: '#/cohortdefinition/' + $component.cohortDefinitionId()}"
          target="_new"
        ></a
      ></span>

      <span data-bind="if: $component.currentCohortDefinition() != null && $component.sampleId()"
        >|&nbsp;&nbsp;Sample:
        <a
          class="asset-heading-link"
          data-bind="text: $component.sampleName(), attr: {href: '#/cohortdefinition/' + $component.cohortDefinitionId() + '/samples/' + $component.sourceKey() +'/' + $component.sampleId()}"
          target="_new"
        ></a
      ></span>
      <!-- ko if: !$component.showPerson2()-->
      <span data-bind="visible: $component.sampleName(),
        click: $component.loadNextPerson" 
        style="float: right; padding-right:20px; text-decoration: underline; cursor: pointer;">
        Next patient <i class="fa fa-angle-right"></i>
      </span>

      <span data-bind="visible: $component.sampleName(),
      click: $component.loadPreviousPerson" 
      style="float: right; padding-right:20px; text-decoration: underline; cursor: pointer;">
        <i class="fa fa-angle-left" style="padding-right: 5px"></i>
        Previous patient 
      </span>
      <!-- /ko -->

      <!-- ko if: $component.showPerson2() -->
      <span style="float: right; padding-right:20px; cursor: pointer;"
        data-bind="click: $component.removePerson"
      >
        <i class="fa fa-times" ></i>
      </span>
      <!-- /ko -->
    </div>
  </div>

  <!-- ko if:loadingPerson -->
  <loading params="status: loadingStatus"></loading>
  <!-- /ko -->

  <div data-bind="visible: cantFindPerson()" class="loading">
    Can't find
    <span data-bind="text:personId" />
  </div>

  <div data-bind="visible: !cantFindPerson() && !loadingPerson()">
    <div data-bind="css: classes()">
        <div data-bind="if: person, attr: { class: 'col-xs-12'}">
					<div id="profileTimeline1" 
						data-bind="visible:showSection.profileChart"
          ></div>
          
          <div data-bind="css: classes('profile-manager-table')">
            <faceted-datatable
              data-bind="visible:showSection.datatable"
              params="{
								reference: personRecords,
								xfObservable: xfObservable,
								columns: columns,
								options: options,
								order: [[3,'asc']],
							}"
            ></faceted-datatable>
					</div>
      </div>
    </div>
    
  </div>


</div>

<div>
  <!-- ko foreach: $component.plugins -->
  <div
    data-bind="with: { html: $data.html, personId: $component.personId, sourceKey: $component.sourceKey, startDate: $component.startDate, endDate: $component.endDate }"
  >
    <div data-bind="template: {nodes: ko.utils.parseHtmlFragment(html)}"></div>
  </div>
  <!-- /ko -->
</div>

<access-denied
  params="isAuthenticated: isAuthenticated, isPermitted: canViewProfiles"
></access-denied>


<!-- ko if: $component.showPerson2()-->
<div class="asset-heading" data-bind="visible: sampleId()&&secondPersonId()">
  <div style="margin-top:5px;">
    <span data-bind="text:'Patient ID: ' + $component.secondPersonId()"></span>&nbsp;&nbsp;|&nbsp;&nbsp;
    <i data-bind="attr: {class : $component.secondPersonGenderClass()}"></i>&nbsp;
    <span data-bind="text: $component.secondPersonGender()"></span>&nbsp;&nbsp;|&nbsp;&nbsp;
    <span data-bind="text: $component.secondPersonRecordCount() + ' events'"></span
    >&nbsp;&nbsp;|&nbsp;&nbsp;
    <span data-bind="text: `Age ${$component.secondPersonAgeAtIndex()} `"></span>
    <span data-bind="if: $component.currentCohortDefinition() != null"
      >at index</span
    >

    <span data-bind="if: $component.currentCohortDefinition() != null"
    >|&nbsp;&nbsp;Cohort:
    <a
      class="asset-heading-link"
      data-bind="text: $component.currentCohortDefinition().name(), attr: {href: '#/cohortdefinition/' + $component.cohortDefinitionId()}"
      target="_new"
    ></a
    ></span>

    <span data-bind="if: $component.currentCohortDefinition() == null"
      >at start of observation</span
    >
    <span data-bind="if: $component.currentCohortDefinition() != null && $component.sampleId()"
        >|&nbsp;&nbsp;Sample:
        <a
          class="asset-heading-link"
          data-bind="text: $component.sampleName(), attr: {href: '#/cohortdefinition/' + $component.cohortDefinitionId() + '/samples/' + $component.sourceKey() +'/' + $component.sampleId()}"
          target="_new"
        ></a
      ></span>
    <span style="float: right; padding-right:20px; cursor: pointer;"
      data-bind="click: $component.removePerson2"
    >
      <i class="fa fa-times" ></i>
    </span>
  </div>
</div>

<div data-bind="css: classes()" style="margin-bottom: 20px;">
  <!-- ko if: $component.loadingSecondPerson() -->
  <loading params="status: loadingStatus"></loading>
  <!-- /ko -->
  <div data-bind="visible: $component.cantFindSecondPerson()" class="loading">
    Can't find
    <span data-bind="text:$component.secondPersonId()" />
  </div>

  <div  id="profileTimeline2" data-bind="visible:showSection.profileChart&&!$component.cantFindSecondPerson()&&!$component.loadingSecondPerson()&&secondPersonId()"></div>
  <faceted-datatable
  data-bind="visible:showSection.datatable&&!$component.cantFindSecondPerson()&&!$component.loadingSecondPerson()&&secondPersonId()"
  params="{
    reference: secondPersonRecords,
    xfObservable: xfObservableSecond,
    columns: columns,
    options: options,
    order: [[3,'asc']],
  }"
></faceted-datatable>
</div>

  <!-- /ko -->

