<div class="loading" data-bind="visible: loading()">loading</div>

<div data-bind="css: classes(), if: !loading()">
	<h2 data-bind="css: classes('title')">
		<a data-bind="attr: { href: `#/pathways/${analysisId()}/executions` }">Executions</a>
		<i data-bind="css: classes({ element: 'title-separator', extra: 'fa fa-chevron-right' })" aria-hidden="true"></i>
		<span data-bind="text: `Pathway Report for ${results().sourceName}`"></span>
	</h2>
	<div data-bind="css: classes('toolbar')">
		<ul data-bind="css: classes('detail-list')">
			<li data-bind="css: classes('detail')">
				<label data-bind="css: classes('detail-label')">Date:</label>
				<span data-bind="css: classes('detail-value'), text: formatDate(results().date)"></span>
			</li>
			<li data-bind="css: classes('detail')">
				<label data-bind="css: classes('detail-label')">Design:</label>
				<a data-bind="css: classes('detail-value'), text: results().designHash">x6t21cda</a>
			</li>
		</ul>
	</div>
	
	<div data-bind="css: classes('filter')">
		<visualizations-filter-panel params="{ filterList: $component.filterList, live: true }"/>
	</div>

	<!-- ko with: pathwaysObserver -->
	<h3 data-bind="css: $component.classes('analysis-name')">Pathways Analysis for <span data-bind="text: title"></span></h3> 
	<!-- ko foreach: cohortPathways -->
	<div data-bind="css: $component.classes('report-group')">
		<div data-bind="css: $component.classes('legend-wrapper')">
			<h5> Event Cohorts</h5>
			<table data-bind="css: $component.classes('table-legend'), foreach: $component.pathwaysObserver().eventCohorts">
				<tr>
					<td><div data-bind="style: {'background-color' : $component.pathwaysObserver().colors(code)}" class="swatch"></div></td>
					<td><div data-bind="css: $component.classes('legend-item'), text: name"></div></td>
				</tr>
			</table>
		</div>
		<div data-bind="css: $component.classes('plot-wrapper')">
			<sunburst data-bind="css: $component.classes('sunburst')" 
					params="data: () => pathway,
						minHeight: 300,
						format: {
								tipClass: $component.classes('d3-tip'),
								split: $component.splitPathway,
								colors: $parent.colors,
								tooltip: $component.tooltipBuilder,
								onclick: $component.pathClickHandler($data)}"></sunburst>
			<div class="info-wrapper">
				<div class="title" data-bind="text: title"/>
				<div class="sub-title" data-bind="text: subTitle"/>
			</div>
		</div>
		<div data-bind="css: $component.classes('info-wrapper')">
			<!-- ko if: pathDetails -->
			<div class="title" data-bind="text: title"/>
			<div class="sub-title" data-bind="text: subTitle"/>
			<table data-bind="css: $component.classes('detail-table')">
				<thead>
					<tr>
						<th>Name</th>
						<th>% Remain</th>
						<th>% Diff</th>
					</tr>
				</thead>
				<tbody data-bind="foreach: pathDetails().tableData">
					<tr>
						<td>
							<div data-bind="css: {group: names.length > 1}, foreach: names">
								<span class="name" data-bind="text: name, style: {backgroundColor: color}"></span>
							</div>
						</td>
						<td data-bind="css: $component.classes('detail-table-col-remain')">
							<span data-bind="text: $component.formatPct(remainPct)"></span>
						</td>
						<td data-bind="css: $component.classes('detail-table-col-diff')">
							<span data-bind="text: $component.formatPct(diffPct)"></span>
						</td>
					</tr>
				</tbody>
			</table>
			<!-- /ko -->
			<!-- ko ifnot: pathDetails -->
			<div>No path selected: click path to see details.</div>
			<!-- /ko -->
		</div>
	</div>
	<!-- /ko -->
	<!-- /ko -->

<!--	
	<div data-bind="if: pathwaysData() != null">
		<textarea data-bind="css: classes('debug'), 
												 text: JSON.stringify($component.pathwaysData(), null, 2)"> </textarea>
	</div>
	
	<div data-bind="if: results() != null">
		<textarea data-bind="css: classes('debug'), text: JSON.stringify(results().data, null, 2)"></textarea>
	</div>

	Greatness awaits here....
-->
</div>
