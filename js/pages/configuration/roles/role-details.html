<!-- ko if:loading -->
<div class="wrapperTitle">
    <i class="fa fa-circle-o-notch fa-spin"></i> Loading...
</div>
<!-- /ko -->
<!-- ko ifnot:loading -->
    <heading-title params="name: roleCaption(), icon: 'cogs', theme: 'dark'"></heading-title>
<!-- /ko -->
<div data-bind="ifnot:loading">
    <div data-bind="if:$component.hasAccess">
        <div class="asset-heading">
            <div class="input-group">
                <input type="text" placeholder="New Role" class="form-control" data-bind="textInput:$component.roleName, attr: { disabled: canEditRole() ? null : true}, css: { emptyInput: !$component.roleName() }" />
                <div class="input-group-btn">
                    <button title="Save" type="button" class="btn btn-success" data-bind="click:$component.save, css: { disabled: !dirtyFlag.isDirty() || !canSave()}"><i class="fa fa-save"></i></button>
                    <button title="Copy" type="button" class="btn btn-primary" data-bind="click:$component.copy, css: { disabled: !canCreate()}"><i class="fa fa-copy"></i></button>
                    <button title="Close" type="button" class="btn btn-primary" data-bind="click:$component.close"><i class="fa fa-times"></i></button>
                    <button title="Export" type="button" class="btn btn-primary" data-bind="click: $component.export"><i class="fa fa-download"></i></button>
                    <button title="Delete" type="button" class="btn btn-danger" data-bind="click: $component.delete, css: { disabled: !canDelete()}"><i class="fa fa-trash-o"></i></button>
                </div>
            </div>
            <div data-bind="visible: !$component.roleName()" class="empty-name-error">
                <i class="fa fa-exclamation-circle" aria-hidden="true"></i>
                <label>Role name is empty.</label>
            </div>
        </div>
        <ul class="nav nav-tabs">
            <li role="presentation" data-bind="click: function() {$component.currentTab('users');}, attr: {class: $component.currentTab() == 'users' ? 'active' : ''}">
                <a>Users</a>
            </li>
            <li role="presentation" data-bind="click: function() {$component.currentTab('permissions');}, attr: {class: $component.currentTab() == 'permissions' ? 'active' : ''}">
                <a>Permissions</a>
            </li>
            <li role="presentation" data-bind="click: function() {$component.currentTab('export');}, attr: {class: $component.currentTab() == 'export' ? 'active' : ''}">
                <a>Export</a>
            </li>
        </ul>
        <div data-bind="if:$component.currentTab() == 'users'">
            <table width="100%" class="roles-table stripe compact hover" cellspacing="0" data-bind="dataTable:{
            data: $component.userItems,
            options: {
                        dom: 'lfiprt',
                        language: {
                            search : 'Filter:'
                        },
                        lengthMenu: [[25, 50, 100, -1], [25, 50, 100,'All']],
                        orderClasses: false,
                        deferRender: true,
                        autoWidth: false,
                        ordering: false,
                        columns: [
                                { class:'text-center', render: function() { return renderCheckbox('isRoleUser', $component.canEditRoleUsers); } },
                                { data: 'login' }
                        ]
                }
        }">
                <thead>
                <tr role="row">
                    <th class="roles-table__included-th text-center sorting_disabled" rowspan="1" colspan="1">
                        <span class="fa fa-check" data-bind="css: { selected: $component.areUsersSelected }, click: function(){$component.areUsersSelected()?$component.deselectAllUsers():$component.selectAllUsers();}"></span>
                        Included
                    </th>
                    <th tabindex="0" rowspan="1" colspan="1">Login</th>
                </tr>
                </thead>
            </table>
        </div>
        <div data-bind="if:$component.currentTab() == 'permissions'">
            <table width="100%" class="stripe compact hover" cellspacing="0" data-bind="dataTable:{
            data: $component.permissionItems,
            options: {
                        dom: 'lfiprt',
                        language: {
                            search : 'Filter:'
                        },
                        lengthMenu: [[25, 50, 100, -1], [25, 50, 100,'All']],
                        orderClasses: false,
                        deferRender: true,
                        autoWidth: false,
                        ordering: true,
                        columnDefs: [
                                { targets: 0, width: '80px', orderable: false },
                        ],
                        columns: [
                                { title: 'Included', class:'text-center', render: function() { return renderCheckbox('isRolePermission', $component.canEditRolePermissions()); } },
                                { title: 'Permission', data: 'permission' },
                                { title: 'Description', data: 'description' }
                        ]
                }
        }"></table>
        </div>


        <div role="tabpanel" data-bind="if:$component.currentTab() == 'export'" class="tab-pane">

            <div data-bind="css: classes('result')" role="alert"  >
                <div data-bind="css: classes('validation-errors'), text: validationErrors"></div>
            </div>

            <!-- ko if: warnings().jsonIssues -->
            <div class="alert alert-danger" role="alert">
                Some of permissions and users in the list are not available on this instance of Atlas. These items will be filtered before importing.
                <a href="#" class="alert-link" data-bind="click: () => $component.fixJSON('jsonIssues')">Fix JSON</a>
            </div>
            <!-- /ko -->
            <!-- ko if: warnings().permissionSpecificIdsIssues -->
            <div class="alert alert-warning" role="alert">
                Some of permissions in the list contain specific entity IDs which are not guaranteed to match between source and target Atlas instances.
                <a href="#" class="alert-link" data-bind="click: () => $component.fixJSON('permissionSpecificIdsIssues')">Remove the permissions</a>
            </div>
            <!-- /ko -->

            <textarea id="cohortExpressionJSON" class="code" style="width: 100%; height: 300px" data-bind="textInput: $component.expressionJSON"></textarea>
            <div class="row">
                <div class="col-md-6" style="float: left">
                    <button class="btn btn-sm btn-primary" title="Copy to clipboard" id="btnCopyExpressionJSONClipboard"
                            data-bind="click: copyRoleExpressionJSONToClipboard" data-clipboard-target="#cohortExpressionJSON"> <i class="fa fa-clipboard" aria-hidden="true"></i> Copy To Clipboard</button>&nbsp;&nbsp;
                    <span id="copyRoleExpressionJSONMessage" style="display:none" class="alert alert-success" role="alert"><i class="fa fa-check-square-o" aria-hidden="true"></i><strong>Copied To Clipboard!</strong></span>
                </div>
                <div class="col-md-6" style="text-align: right">
                    <button class="btn btn-sm btn-primary" data-bind="click: $component.reload, enable: isJSONValid">Reload</button>
                </div>

            </div>
        </div>

    </div>
</div>
