<select data-bind="options: conceptSets,
	optionsText: function(item) { return item.name },
	optionsCaption: ko.i18n('components.conceptSetBuilder.pleaseSelectCodesetToModify', 'Please select codeset to modify...'),
	value: selectedConceptSet" class="mediumInputField">
</select>
<button class="btn btn-primary btn-sm" data-bind="visible: isEditable(), click: function () { $component.createConceptSet() }, text: ko.i18n('components.conceptSetBuilder.newConceptSet', 'New Concept Set')"></button>
<button class="btn btn-primary btn-sm" data-bind="visible: isEditable() && !(selectedConceptSet()), click: function () { $component.isModalOpened(true) }, text: ko.i18n('components.conceptSetBuilder.load', 'Load')"></button>
<button class="btn btn-primary btn-sm" data-bind="visible: isEditable() && selectedConceptSet, click: function () { $component.isImportEnabled(true) }, text: ko.i18n('components.conceptSetBuilder.import', 'Import')"></button>
<button class="btn btn-primary btn-sm" data-bind="visible: isEditable() && selectedConceptSet, click: function () { $component.isExportEnabled(true) }, text: ko.i18n('components.conceptSetBuilder.export', 'Export')"></button>
<button class="btn btn-danger btn-sm" data-bind="visible: isEditable() && selectedConceptSet, click: function () { $component.deleteConceptSet() }, text: ko.i18n('components.conceptSetBuilder.delete', 'Delete')"></button>
<div data-bind="if: selectedConceptSet">
		<div class="tabs" data-bind="tabs: { widget: $component.tabWidget }">
		<ul>
			<li data-bind="attr: { 'aria-controls': 'csExpression' }">
				<a data-bind="attr: { title: 'Concept Set Expression', href: '#csExpression' }, text: ko.i18n('components.conceptSetBuilder.conceptSet', 'Concept Set')"></a>
			</li>
			<li data-bind="attr: { 'aria-controls': 'csIncluded' }">
				<a data-bind="attr: { title: 'Concept Sets', href: '#csIncluded' }">
					<span data-bind="text: ko.i18n('components.conceptSetBuilder.includedConcepts', 'Included Concepts')"></span>
					<!-- ko if: includedConceptsComponent() && includedConceptsComponent().isLoading() -->
					<img class="spin" style="width: 14px; height: 14px" src="images/running.png" />
					<!-- /ko -->
					<!-- ko if: !(includedConceptsComponent() && includedConceptsComponent().isLoading()) -->
					<span style="font-size: .75em" class="badge" data-bind="text: includedConceptsComponent() && includedConceptsComponent().includedConcepts().length"></span>
					<!-- /ko -->
				</a>
			</li>
			<li data-bind="attr: { 'aria-controls': 'csMapped' }">
				<a data-bind="attr: { title: 'Mapped Concepts', href: '#csMapped' }">
					<span data-bind="text: ko.i18n('components.conceptSetBuilder.mappedConcepts', 'Mapped Concepts')"></span>
					<!-- ko if: mappedConceptsComponent() && mappedConceptsComponent().isLoading() -->
					<img class="spin" style="width: 14px; height: 14px" src="images/running.png" />
					<!-- /ko -->
					<!-- ko if: !(mappedConceptsComponent() && mappedConceptsComponent().isLoading()) -->
					<span style="font-size: .75em" class="badge" data-bind="text: mappedConceptsComponent() && mappedConceptsComponent().mappedConcepts().length"></span>
					<!-- /ko -->
				</a>
			</li>
		</ul>
		<div data-bind="attr: { id: 'csExpression' }">
			<div data-bind="with: selectedConceptSet" style="padding: 5px;">
				<input style="width: 100%" data-bind="value:name"></input>
				<table cellspacing="0" width="100%" data-bind="dataTable: {
						data: expression.items,
						api: $component.dtApi,
						options: {
							orderClasses: false,
							deferRender: true,
							order: [[2, 'desc']],
							columns: [
									'select',
									{ data: 'concept.CONCEPT_ID', title: ko.i18n('columns.conceptId', 'Concept Id') },
									{ data: 'concept.CONCEPT_CODE', title: ko.i18n('columns.conceptCode', 'Concept Code')},
									{ data: 'concept.CONCEPT_NAME', title: ko.i18n('columns.conceptName', 'Concept Name')},
									{ data: 'concept.DOMAIN_ID', title: ko.i18n('columns.domain', 'Domain')},
									{ data: 'concept.VOCABULARY_ID', title: ko.i18n('columns.vocabulary', 'Vocabulary')},
									{ class: 'text-center', orderable:false, render: function() { return $component.renderCheckbox('isExcluded');}, title: ko.i18n('columns.exclude', 'Exclude')},
									{ class: 'text-center', orderable:false,render: function() { return $component.renderCheckbox('includeDescendants');}, title: ko.i18n('columns.descendants', 'Descendants')},
									{ class: 'text-center', orderable:false,render: function() { return $component.renderCheckbox('includeMapped');}, title: ko.i18n('columns.mapped', 'Mapped')}
							],
							language: ko.i18n('datatable.language')
					 }
				}, css: {stripe: true, compact:true, hover:true, 'tab-disabled': !$component.isEditable()}">
				</table>
			</div>
			<div data-bind="visible: $component.isEditable()">
				<concept-picker params="onAdd: $component.addConcepts"></concept-picker><button class="btn btn-danger btn-sm" data-bind="click: function () { $component.removeSelected() }, text: ko.i18n('components.conceptSetBuilder.removeSelected', 'Remove Selected')"></button>
			</div>
		</div>
		<div data-bind="attr: { id: 'csIncluded' }">
			<div style="padding: 5px;">
				<input style="width: 100%" data-bind="value:name"></input>
				<concept-set-included-concepts params="conceptSet: selectedConceptSet, widget:includedConceptsComponent, canEdit: $component.isEditable"></concept-set-included-concepts>
			</div>
		</div>
		<div data-bind="attr: { id: 'csMapped' }">
			<div style="padding: 5px;">
				<input style="width: 100%" data-bind="value:name"></input>
				<concept-set-mapped-concepts params="conceptSet: selectedConceptSet, widget:mappedConceptsComponent, canEdit: $component.isEditable"></concept-set-mapped-concepts>
			</div>

		</div>
	</div>
	<!-- ko if: isImportEnabled -->
	<div title="Import Concept Set" style="padding: 0px; padding-top: 5px; padding-right: 5px" data-bind="dialog: { isOpen: isImportEnabled, modal: true, width:700, height:500, closeText: '', title: ko.i18n('components.conceptSetBuilder.importConceptSetTitle', 'Import Concept Set...')}">
		<div style="height:100%; overflow: none; padding-top: 5px; padding-bottom: 40px;">
			<textarea style="width: 100%; height: 100%; resize: none" data-bind="textInput: importValues, placeholder: ko.i18n('components.conceptSetBuilder.importConceptSetPlaceholder', 'Import Concept Set')"></textarea>
		</div>
		<div style="position: relative; margin-top: -30px; height: 30px; clear: both;">
			<button class="btn btn-sm btn-primary" data-bind="click: doImport, text: ko.i18n('components.conceptSetBuilder.import', 'Import')"></button>
		</div>
	</div>
	<!-- /ko -->
	<!-- ko if: isExportEnabled -->
	<div style="padding: 0px; padding-top: 5px; padding-right: 5px" data-bind="dialog: { isOpen: isExportEnabled, modal: true, width:700, height:500, closeText: '', title: ko.i18n('components.conceptSetBuilder.exportConceptSetTitle', 'Export Concept Set...')}">
		<div style="height:100%; overflow: none; padding-top: 5px; padding-bottom: 10px;">
			<textarea style="width: 100%; height: 100%; resize: none" data-bind="value: getConceptSetJson()"></textarea>
		</div>
	</div>
	<!-- /ko -->
</div>

<atlas-modal params="
	showModal: isModalOpened,
	title: ko.i18n('components.conceptSetBuilder.selectConceptSet', 'Select Concept Set...'),
	data: { repositoryConceptsetSelected }
">
	<concept-set-browser params="{onRespositoryConceptSetSelected: repositoryConceptsetSelected}"></concept-set-browser>
</atlas-modal>
